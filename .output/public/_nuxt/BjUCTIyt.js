import{f as k,r as d,n as S,p as C,j as E,c,a as t,l as I,q as N,t as T,s as j,v as f,x as y,b as x,w as v,e as L,o as u,d as w}from"./CUe4Mrkt.js";const V={class:"min-h-screen bg-gray-50 flex items-center justify-center px-4"},B={class:"w-full max-w-md"},M={class:"bg-white rounded-2xl shadow-sm p-8 space-y-6"},J={key:0,class:"p-3 bg-red-50 border border-red-200 rounded-xl"},U={class:"text-red-600 text-sm"},A={class:"space-y-2"},D={class:"space-y-2"},q=["disabled"],O={key:0},P={key:1},W={class:"text-center"},R={class:"text-center mt-6"},z=k({__name:"login",setup(G){const p=d(""),m=d(""),a=d(""),n=d(!1),l=S()||C().$router;function g(o){try{const e=o.split(".");if(e.length!==3)throw new Error("Invalid JWT format");const s=e[1];if(!s)throw new Error("Invalid JWT payload");const r=s.replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(atob(r).split("").map(_=>"%"+("00"+_.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(i)}catch{return null}}function b(o){const e=g(o);if(!e||!e.exp)return!0;const s=Math.floor(Date.now()/1e3);return e.exp<s}E(()=>{const o=localStorage.getItem("token");if(o)if(b(o))localStorage.removeItem("token");else{const e=g(o);if(e&&e.role){const s=e.role.toLowerCase();s==="admin"?l.push("/admin"):s==="user"&&l.push("/user")}}});async function h(){a.value="",n.value=!0;try{const o=await fetch("http://localhost:3000/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p.value,password:m.value})}),e=await o.json();if(!o.ok||!e.success)throw new Error(e.message||"Login failed");const s=e.data.token;localStorage.setItem("token",s);const r=g(s);if(!r||!r.role)throw new Error("Invalid token payload");const i=r.role.toLowerCase();if(i==="admin")await l.push("/admin");else if(i==="user")await l.push("/user");else throw new Error("Unknown role")}catch(o){a.value=o.message||"An error occurred during login"}finally{n.value=!1}}return(o,e)=>{const s=L;return u(),c("div",V,[t("div",B,[t("div",M,[e[6]||(e[6]=t("div",{class:"text-center space-y-2"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"Welcome Back"),t("p",{class:"text-gray-600"},"Sign in to your account.")],-1)),a.value?(u(),c("div",J,[t("p",U,T(a.value),1)])):I("",!0),t("form",{onSubmit:j(h,["prevent"]),class:"space-y-4"},[t("div",A,[e[2]||(e[2]=t("label",{for:"email",class:"block text-sm font-medium text-gray-700"}," Email ",-1)),f(t("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=r=>p.value=r),type:"email",required:"",placeholder:"Enter your email",class:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent outline-none transition-all duration-200 bg-gray-50 focus:bg-white"},null,512),[[y,p.value]])]),t("div",D,[e[3]||(e[3]=t("label",{for:"password",class:"block text-sm font-medium text-gray-700"}," Password ",-1)),f(t("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=r=>m.value=r),type:"password",required:"",placeholder:"Enter your password",class:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent outline-none transition-all duration-200 bg-gray-50 focus:bg-white"},null,512),[[y,m.value]])]),t("button",{type:"submit",disabled:n.value,class:"w-full bg-gray-900 text-white py-3 px-4 rounded-xl font-medium hover:bg-gray-800 transition-all duration-200 shadow-sm hover:shadow-md active:scale-95 mt-6 disabled:opacity-50 disabled:cursor-not-allowed"},[n.value?(u(),c("span",O,"Signing In...")):(u(),c("span",P,"Sign In"))],8,q)],32),e[7]||(e[7]=N('<div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">or</span></div></div>',1)),t("div",W,[e[5]||(e[5]=t("span",{class:"text-gray-600"},"Don't have an account? ",-1)),x(s,{to:"/register",class:"text-gray-900 font-medium hover:text-gray-700 transition-colors duration-200"},{default:v(()=>e[4]||(e[4]=[w(" Create Account ")])),_:1,__:[4]})])]),t("div",R,[x(s,{to:"/",class:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors duration-200"},{default:v(()=>e[8]||(e[8]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),w(" Back to Game Library ")])),_:1,__:[8]})])])])}}});export{z as default};
